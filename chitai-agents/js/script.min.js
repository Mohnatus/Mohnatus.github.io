"use strict";(function(){var e=function(e){Array.prototype.slice.call(document.querySelectorAll("[data-close]")).forEach(function(e){var t=e.getAttribute("data-close"),r=document.querySelector(t);e.addEventListener("click",function(){r.setAttribute("data-hidden","");var e=parseInt(document.body.getAttribute("data-popup-open"))||1;document.body.setAttribute("data-popup-open",--e)})})};function t(e){var t=this;this.$=e,this.input=this.$.querySelector("input, textarea"),this.label=this.$.querySelector("label"),this.input.addEventListener("input",function(){t.onInput&&t.onInput(t.input.value)}),this.input.addEventListener("focus",function(){t.$.setAttribute("data-focus",""),t.onFocus&&t.onFocus()}),this.input.addEventListener("blur",function(){t.input.value||t.$.removeAttribute("data-focus"),t.onBlur&&t.onBlur()})}t.init=function(){Array.prototype.slice.call(document.querySelectorAll(".x-input")).forEach(function(e){new t(e)})};var r=t;function o(e){var i=this;this.form=e.form;var t=Array.prototype.slice.call(this.form.querySelectorAll(e.fields));this.rules=e.rules||{},this.passed={},this.errors={},this.fields=[],this.onSubmit=e.onSubmit,this.onReady=e.onReady,this.onUnready=e.onUnready,this.ready=!1,e.trigger.addEventListener("click",this.validate.bind(this)),t.forEach(function(e){var t=e.getAttribute("data-validate")||"text",r=Array.prototype.slice.call(e.querySelectorAll("input, textarea")),a=r[0].getAttribute("name"),n={$:e,name:a,type:t,inputs:r,validated:!1,valid:!1,error:e.querySelector(".message")};r.forEach(function(e){"radio"==e.type||"checkbox"==e.type?e.addEventListener("change",function(){i.validateField(n)}):e.addEventListener("input",function(){i.validateField(n)})}),i.fields.push(n),i.passed[a]=!1}),this.validated=!1}o.messages={required:function(){return"Поле обязательно для заполнения"},minLength:function(e){return"Минимальная длина - "+e+" символов"},maxLength:function(e){return"Максимальная длина - "+e+" символов"},length:function(e){return"Длина - "+e+" символов"},default:function(e){return"Неправильно заполнено поле"}},o.prototype.validate=function(){var r=this;this.errors={};var a=0;this.fields.forEach(function(e){var t=r.validateField(e);t.error&&(r.errors[e.name]=t.error,a++)}),this.validated=!0,a||this.onSubmit&&this.onSubmit()},o.prototype.checkAllFields=function(){for(var e in this.passed)if(!this.passed[e])return void this.unreadyHandler();this.readyHandler()},o.prototype.validateField=function(e){var t=this.rules[e.name],r={};for(var a in t){var n=t[a];if(n.value){var i=void 0;switch(a){case"required":i=this.checkRequired(e);break;case"custom":i=n.value(e)}if(!i){r.error=n.message||o.messages[a](n.value)||o.messages.default();break}}}return e.validated=!0,e.valid=!r.error,r.error?this.setInvalid(e,r.error):this.setValid(e),this.passed[e.name]=e.valid,this.checkAllFields(),r},o.prototype.checkRequired=function(e){switch(e.type){case"text":return!!e.inputs[0].value;case"radio":case"checkbox":return e.inputs.some(function(e){return e.checked})}return!1},o.prototype.setInvalid=function(e,t){e.$.removeAttribute("data-valid"),e.$.setAttribute("data-invalid",""),e.error.innerHTML=t},o.prototype.setValid=function(e){e.$.removeAttribute("data-invalid"),e.$.setAttribute("data-valid",""),e.error.innerHTML=""},o.prototype.readyHandler=function(){this.ready||(this.form.setAttribute("data-ready",""),this.ready=!0,this.onReady&&this.onReady())},o.prototype.unreadyHandler=function(){this.ready&&(this.form.removeAttribute("data-ready"),this.ready=!1,this.onUnready&&this.onUnready())};var a=o;$(document).ready(function(){autosize($("textarea")),e(),r.init();var t=document.querySelector(".agent-form");new a({form:t,fields:"[data-validate]",rules:{"agent-parent":{required:{value:!0}},"agent-child":{required:{value:!0}},"agent-book":{required:{value:!0}},"agent-age":{required:{value:!0}},"agent-post":{required:{value:!0}},"agent-confirm":{required:{value:!0}}},trigger:document.querySelector(".agent-form__send"),onSubmit:function(){var e=new FormData(t);console.log(e.getAll("agent-parent")),console.log(e.getAll("agent-child")),console.log(e.getAll("agent-age")),console.log(e.getAll("agent-book")),$(".agents-join .container").addClass("info").html("<div class='info-message'><h2>Ваша заявка принята!</h2>Пост отправлен на модерацию: мы должны убедиться, что он соответствует правилам конкурса.<br>Такая проверка занимает <b>1 рабочий день</b>, по окончании модерации вы получите письмо.</div>")},onReady:function(){$(".agents-join").attr("data-ready","")},onUnready:function(){$(".agents-join").removeAttr("data-ready")}});$('[data-action="take-part"]').on("click",function(){var e=parseInt($("body").attr("data-popup-open",""))||0;$("body").attr("data-popup-open",++e),$(".chg-agents__join").removeAttr("data-hidden")})})}).call(void 0);